function startStreamFrom(e){navigator.webkitGetUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:320,maxHeight:240}}},function(e){var t=URL.createObjectURL(e),o=document.createElement("video"),a=document.createElement("canvas"),n=a.getContext("2d");o.autoplay=!0,o.muted=!0,o.addEventListener("loadedmetadata",function(){a.width=this.videoWidth,a.height=this.videoHeight},!1),o.src=t,setInterval(function(){console.log("are you still there?"),n.drawImage(o,0,0),data=a.toDataURL(),ws.send(data)},100)},function(e){console.log("error!",e)})}ws=new WebSocket("ws://localhost:8088"),port=chrome.runtime.connect(),port.onMessage.addListener(function(e){console.log("got some data from the background script"),startStreamFrom(e.sourceId),navigator.webkitGetUserMedia(e.sourceId)}),window.addEventListener("message",function(e){return e.source==window?"are-you-there"==e.data?window.postMessage("rtcmulticonnection-extension-loaded","*"):void("get-sourceId"==e.data&&port.postMessage(e.data)):void 0}),window.postMessage("rtcmulticonnection-extension-loaded","*");